import{d as Y,r as u,g as H,s as J,y as Q,j as k,b as e,i as w,h as X,w as m,p as b,B as v,t as g,c as n,f as _,n as B,e as c,F as C,z as M,K as Z,L as ee,T as te,u as re,o as l}from"./index-DjcpV5CO.js";import{_ as se}from"./MainLayout.vue_vue_type_style_index_0_lang-aD109F3i.js";import{u as ae}from"./useMemoriesStore-DPyh1fRy.js";import"./useThemeStore-BI_Bm76I.js";const oe={class:"mb-4 md:mb-6"},le={class:"max-w-4xl mx-auto"},ne={class:"bg-white dark:bg-gray-800 rounded-xl md:rounded-2xl shadow-sm p-4 md:p-6 border border-gray-100 dark:border-gray-700"},de={class:"space-y-4 md:space-y-6"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6"},ue={class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},pe={class:"bg-white dark:bg-gray-800 rounded-xl md:rounded-2xl shadow-sm p-4 md:p-6 border border-gray-100 dark:border-gray-700"},ge={class:"mb-6 md:mb-8"},ce={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},xe={key:0,class:"mt-6"},me={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3"},be=["src","alt"],ye=["onClick"],fe={class:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2 text-white text-xs"},ve={class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3"},ke={key:0,class:"mt-6"},he={class:"space-y-3"},we={class:"flex-1 min-w-0"},_e={class:"text-sm font-medium text-gray-800 dark:text-gray-200 truncate"},Ce={class:"text-xs text-gray-500 dark:text-gray-400"},Me=["onClick"],De={class:"bg-white dark:bg-gray-800 rounded-xl md:rounded-2xl shadow-sm p-4 md:p-6 border border-gray-100 dark:border-gray-700"},Ve={class:"space-y-4 md:space-y-6"},Se={class:"flex flex-wrap gap-2 mb-3"},Ie=["onClick"],Te={class:"flex gap-2"},je=["onKeydown"],Pe={class:"space-y-4"},Be={class:"flex items-center justify-between"},ze={class:"relative inline-flex items-center cursor-pointer"},Fe={class:"flex flex-col sm:flex-row gap-3 pt-4"},Ae=["disabled"],Ue={key:0,class:"bx bx-loader-alt animate-spin"},Le={key:1,class:"bx bx-save"},Ne={key:0,class:"fixed bottom-4 right-4 md:bottom-6 md:right-6 bg-green-500 text-white rounded-xl shadow-lg p-4 md:p-5 max-w-sm z-50"},Oe={class:"flex items-center gap-3"},qe=Y({__name:"NewMemoryIndex",setup(We){const z=re(),F=ae(),a=u({title:"",date:new Date().toISOString().split("T")[0],location:"",description:"",tags:[],isFavorite:!1}),x=u(""),d=u([]),p=u([]),y=u(!1),f=u(!1),h=u(!1),D=u(),V=u(),S=s=>{if(s===0)return"0 Bytes";const t=1024,o=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,r)).toFixed(1))+" "+o[r]},I=s=>URL.createObjectURL(s),T=()=>{x.value.trim()&&!a.value.tags.includes(x.value.trim())&&(a.value.tags.push(x.value.trim()),x.value="")},A=s=>{a.value.tags.splice(s,1)},U=()=>{D.value?.click()},L=()=>{V.value?.click()},N=s=>{const t=s.target;if(t.files){const o=Array.from(t.files).filter(r=>r.type.startsWith("image/")&&r.size<=10485760);d.value.push(...o)}t.value=""},O=s=>{const t=s.target;if(t.files){const o=Array.from(t.files).filter(r=>r.type.startsWith("video/")&&r.size<=52428800);p.value.push(...o)}t.value=""},j=s=>{s.preventDefault(),y.value=!0},W=s=>{s.preventDefault(),y.value=!1;const t=s.dataTransfer?.files;if(t){const o=Array.from(t).filter(r=>r.type.startsWith("image/")&&r.size<=10485760);d.value.push(...o)}},$=s=>{s.preventDefault(),y.value=!1;const t=s.dataTransfer?.files;if(t){const o=Array.from(t).filter(r=>r.type.startsWith("video/")&&r.size<=52428800);p.value.push(...o)}},E=s=>{d.value.splice(s,1)},K=s=>{p.value.splice(s,1)},R=()=>{d.value=[]},q=()=>{p.value=[]},G=async()=>{if(!a.value.title.trim()||!a.value.date){alert("Please fill in required fields: Title and Date");return}const s=new Date(a.value.date),t=new Date;if(t.setHours(0,0,0,0),s>t){alert("Memory date cannot be in the future");return}f.value=!0;try{const o=await F.createMemory({...a.value,isDeleted:!1},d.value,p.value);h.value=!0,setTimeout(()=>z.push(`/memories/details/${o}`),2e3)}catch(o){console.error("Error saving memory:",o),o.code==="permission-denied"?alert("You do not have permission to save memories. Please check your authentication."):o.code==="failed-precondition"?alert("Could not save memory. Please try again."):alert("Failed to save memory. Please try again.")}finally{f.value=!1}};return H(()=>{a.value.date=new Date().toISOString().split("T")[0]}),J(()=>{d.value.forEach(s=>{URL.revokeObjectURL(I(s))})}),(s,t)=>{const o=X("router-link");return l(),Q(se,null,{default:k(()=>[e("div",oe,[w(o,{to:"/private/memories",class:"inline-flex items-center gap-2 text-pink-600 hover:text-pink-700 dark:text-pink-400 dark:hover:text-pink-300 transition-colors text-sm md:text-base"},{default:k(()=>[...t[7]||(t[7]=[e("i",{class:"bx bx-arrow-back text-lg md:text-xl"},null,-1),e("span",{class:"font-medium"},"Back to Memories",-1)])]),_:1})]),e("div",le,[t[28]||(t[28]=e("div",{class:"mb-6 md:mb-8"},[e("h1",{class:"text-2xl md:text-3xl font-bold text-gray-800 dark:text-gray-100 mb-2"}," Create New Memory "),e("p",{class:"text-gray-600 dark:text-gray-400"}," Preserve your precious moments with photos, videos, and details ")],-1)),e("form",{onSubmit:m(G,["prevent"]),class:"space-y-6 md:space-y-8"},[e("div",ne,[t[12]||(t[12]=e("div",{class:"flex items-center gap-2 mb-4 md:mb-6"},[e("div",{class:"w-10 h-10 rounded-lg md:rounded-xl bg-pink-100 dark:bg-pink-900/30 flex items-center justify-center"},[e("i",{class:"bx bx-edit text-pink-600 dark:text-pink-400"})]),e("h2",{class:"text-lg md:text-xl font-semibold text-gray-800 dark:text-gray-100"}," Basic Information ")],-1)),e("div",de,[e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Memory Title * ",-1)),b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>a.value.title=r),type:"text",placeholder:"What's this memory about?",required:"",class:"w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200 placeholder-gray-400 dark:placeholder-gray-500"},null,512),[[v,a.value.title]])]),e("div",ie,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Date * ",-1)),b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>a.value.date=r),type:"date",required:"",class:"w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200"},null,512),[[v,a.value.date]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Location ",-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>a.value.location=r),type:"text",placeholder:"Where did this happen?",class:"w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200 placeholder-gray-400 dark:placeholder-gray-500"},null,512),[[v,a.value.location]])])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Description ",-1)),b(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=r=>a.value.description=r),rows:"4",placeholder:"Tell the story behind this memory...",class:"w-full px-4 py-3 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition-all duration-200 resize-none placeholder-gray-400 dark:placeholder-gray-500"},null,512),[[v,a.value.description]]),e("p",ue,g(a.value.description?.length||0)+"/500 characters ",1)])])]),e("div",pe,[t[20]||(t[20]=e("div",{class:"flex items-center gap-2 mb-4 md:mb-6"},[e("div",{class:"w-10 h-10 rounded-lg md:rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center"},[e("i",{class:"bx bx-image text-blue-600 dark:text-blue-400"})]),e("h2",{class:"text-lg md:text-xl font-semibold text-gray-800 dark:text-gray-100"}," Photos & Videos ")],-1)),e("div",ge,[e("label",ce," Photos ("+g(d.value.length)+" selected) ",1),e("div",{onClick:U,onDragover:m(j,["prevent"]),onDrop:m(W,["prevent"]),class:B(["border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-6 md:p-8 text-center cursor-pointer transition-all duration-200 hover:border-pink-400 dark:hover:border-pink-500 hover:bg-pink-50/30 dark:hover:bg-pink-900/10",{"border-pink-500 bg-pink-50/50 dark:bg-pink-900/20":y.value}])},[...t[13]||(t[13]=[e("div",{class:"w-16 h-16 mx-auto mb-4 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center"},[e("i",{class:"bx bx-cloud-upload text-2xl text-blue-600 dark:text-blue-400"})],-1),e("p",{class:"text-gray-700 dark:text-gray-300 mb-2 font-medium"}," Drop photos here or click to upload ",-1),e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-4"}," Supports JPG, PNG, WEBP up to 10MB each ",-1),e("button",{type:"button",class:"inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-medium hover:shadow-lg transition-all duration-200"},[e("i",{class:"bx bx-plus"}),c(" Select Photos ")],-1)])],34),e("input",{ref_key:"imageInput",ref:D,type:"file",multiple:"",accept:"image/*",onChange:N,class:"hidden"},null,544),d.value.length>0?(l(),n("div",xe,[e("div",me,[(l(!0),n(C,null,M(d.value,(r,i)=>(l(),n("div",{key:i,class:"relative aspect-square rounded-lg overflow-hidden group"},[e("img",{src:I(r),alt:`Preview ${i+1}`,class:"w-full h-full object-cover"},null,8,be),e("button",{type:"button",onClick:P=>E(i),class:"absolute top-1 right-1 w-6 h-6 rounded-full bg-red-500 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:scale-110"},[...t[14]||(t[14]=[e("i",{class:"bx bx-x text-sm"},null,-1)])],8,ye),e("div",fe,g(S(r.size)),1)]))),128))]),e("div",{class:"mt-4 flex justify-end"},[e("button",{type:"button",onClick:R,class:"text-sm text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium flex items-center gap-1"},[...t[15]||(t[15]=[e("i",{class:"bx bx-trash"},null,-1),c(" Clear All Photos ",-1)])])])])):_("",!0)]),e("div",null,[e("label",ve," Videos ("+g(p.value.length)+" selected) ",1),e("div",{onClick:L,onDragover:m(j,["prevent"]),onDrop:m($,["prevent"]),class:B(["border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-6 md:p-8 text-center cursor-pointer transition-all duration-200 hover:border-green-400 dark:hover:border-green-500 hover:bg-green-50/30 dark:hover:bg-green-900/10",{"border-green-500 bg-green-50/50 dark:bg-green-900/20":y.value}])},[...t[16]||(t[16]=[e("div",{class:"w-16 h-16 mx-auto mb-4 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center"},[e("i",{class:"bx bx-video-plus text-2xl text-green-600 dark:text-green-400"})],-1),e("p",{class:"text-gray-700 dark:text-gray-300 mb-2 font-medium"}," Drop videos here or click to upload ",-1),e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mb-4"}," Supports MP4, MOV up to 50MB each ",-1),e("button",{type:"button",class:"inline-flex items-center gap-2 px-4 py-2.5 rounded-xl bg-gradient-to-r from-green-500 to-emerald-500 text-white font-medium hover:shadow-lg transition-all duration-200"},[e("i",{class:"bx bx-plus"}),c(" Select Videos ")],-1)])],34),e("input",{ref_key:"videoInput",ref:V,type:"file",multiple:"",accept:"video/*",onChange:O,class:"hidden"},null,544),p.value.length>0?(l(),n("div",ke,[e("div",he,[(l(!0),n(C,null,M(p.value,(r,i)=>(l(),n("div",{key:i,class:"flex items-center gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-700/30"},[t[18]||(t[18]=e("div",{class:"w-12 h-12 rounded-lg bg-green-100 dark:bg-green-900/30 flex items-center justify-center flex-shrink-0"},[e("i",{class:"bx bx-video text-green-600 dark:text-green-400"})],-1)),e("div",we,[e("p",_e,g(r.name),1),e("p",Ce,g(S(r.size)),1)]),e("button",{type:"button",onClick:P=>K(i),class:"p-1.5 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/30 text-red-600 dark:text-red-400"},[...t[17]||(t[17]=[e("i",{class:"bx bx-x"},null,-1)])],8,Me)]))),128))]),e("div",{class:"mt-4 flex justify-end"},[e("button",{type:"button",onClick:q,class:"text-sm text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium flex items-center gap-1"},[...t[19]||(t[19]=[e("i",{class:"bx bx-trash"},null,-1),c(" Clear All Videos ",-1)])])])])):_("",!0)])]),e("div",De,[t[26]||(t[26]=e("div",{class:"flex items-center gap-2 mb-4 md:mb-6"},[e("div",{class:"w-10 h-10 rounded-lg md:rounded-xl bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center"},[e("i",{class:"bx bx-purchase-tag text-purple-600 dark:text-purple-400"})]),e("h2",{class:"text-lg md:text-xl font-semibold text-gray-800 dark:text-gray-100"}," Tags & Options ")],-1)),e("div",Ve,[e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Tags ",-1)),e("div",Se,[(l(!0),n(C,null,M(a.value.tags,(r,i)=>(l(),n("span",{key:i,class:"inline-flex items-center gap-1 px-3 py-1.5 rounded-full bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 text-sm"},[c(g(r)+" ",1),e("button",{type:"button",onClick:P=>A(i),class:"hover:text-purple-900 dark:hover:text-purple-200"},[...t[21]||(t[21]=[e("i",{class:"bx bx-x text-xs"},null,-1)])],8,Ie)]))),128))]),e("div",Te,[b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=r=>x.value=r),type:"text",placeholder:"Add a tag and press Enter",onKeydown:Z(m(T,["prevent"]),["enter"]),class:"flex-1 px-4 py-2.5 rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 placeholder-gray-400 dark:placeholder-gray-500 text-sm"},null,40,je),[[v,x.value]]),e("button",{type:"button",onClick:T,class:"px-4 py-2.5 rounded-xl bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 font-medium hover:bg-purple-200 dark:hover:bg-purple-800 transition-colors"}," Add ")]),t[23]||(t[23]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400 mt-2"}," Press Enter or click Add to include tags ",-1))]),e("div",Pe,[e("div",Be,[t[25]||(t[25]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"w-10 h-10 rounded-lg bg-pink-100 dark:bg-pink-900/30 flex items-center justify-center"},[e("i",{class:"bx bx-heart text-pink-600 dark:text-pink-400"})]),e("div",null,[e("p",{class:"font-medium text-gray-800 dark:text-gray-200"},"Mark as Favorite"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," Pin this memory to your favorites ")])],-1)),e("label",ze,[b(e("input",{"onUpdate:modelValue":t[5]||(t[5]=r=>a.value.isFavorite=r),type:"checkbox",class:"sr-only peer"},null,512),[[ee,a.value.isFavorite]]),t[24]||(t[24]=e("span",{class:"w-11 h-6 bg-gray-200 dark:bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-pink-300 dark:peer-focus:ring-pink-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-pink-500"},null,-1))])])])])]),e("div",Fe,[w(o,{to:"/private/memories",class:"flex-1 px-6 py-3.5 rounded-xl border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-medium text-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"},{default:k(()=>[...t[27]||(t[27]=[c(" Cancel ",-1)])]),_:1}),e("button",{type:"submit",disabled:f.value,class:"flex-1 px-6 py-3.5 rounded-xl bg-gradient-to-r from-pink-500 to-purple-500 text-white font-medium hover:shadow-lg hover:scale-[1.02] active:scale-95 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[f.value?(l(),n("i",Ue)):(l(),n("i",Le)),c(" "+g(f.value?"Saving Memory...":"Save Memory"),1)],8,Ae)])],32)]),w(te,{name:"slide-up"},{default:k(()=>[h.value?(l(),n("div",Ne,[e("div",Oe,[t[30]||(t[30]=e("div",{class:"w-10 h-10 rounded-full bg-green-400/30 flex items-center justify-center"},[e("i",{class:"bx bx-check text-xl"})],-1)),t[31]||(t[31]=e("div",{class:"flex-1"},[e("p",{class:"font-semibold"},"Memory Saved!"),e("p",{class:"text-sm opacity-90"},"Your memory has been successfully saved.")],-1)),e("button",{onClick:t[6]||(t[6]=r=>h.value=!1),class:"p-1 hover:opacity-80"},[...t[29]||(t[29]=[e("i",{class:"bx bx-x"},null,-1)])])])])):_("",!0)]),_:1})]),_:1})}}});export{qe as default};
