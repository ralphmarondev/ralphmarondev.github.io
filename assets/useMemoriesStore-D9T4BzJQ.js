import{k as I,r as y,M as R,N as f,O as U,P as x,Q as A,S as w,U as B,A as F,V as O,W as b,H as q,X as E,I as P}from"./index-Bk0_C35p.js";const X=I("memories",()=>{const a=y([]),c=y(!1),S=y(null),h=async e=>{if(!c.value){S.value=null;try{const t=R(f,`users/${e}/memories`),s=U(t,x("date","desc")),o=await A(s);a.value=o.docs.map(r=>{const i=r.data();return{id:r.id,...i}}),c.value=!0}catch(t){console.error(t),t.value=t.message||"Failed to fetch memories"}}};return{memories:a,loaded:c,error:S,fetchMemories:h,refreshMemories:async e=>{c.value=!1,await h(e)},getMemoryById:e=>a.value.find(t=>t.id===e),getDeletedMemories:()=>a.value.filter(e=>e.isDeleted),updateMemory:async(e,t,s)=>{const o=a.value.findIndex(r=>r.id===e);if(o!==-1){a.value[o]={...a.value[o],...t};try{const r=w(f,`users/${s}/memories`,e);await B(r,t)}catch(r){console.error("Failed to update memory:",r)}}},createMemory:async(e,t,s)=>{const r=F().user?.email;if(!r)throw new Error("User not authenticated");const i=async(l,n)=>{const g=b();return Promise.all(l.map(async d=>{const u=q(g,`users/${r}/${n}/${Date.now()}_${d.name}`);return await E(u,d),P(u)}))},D=t.length?await i(t,"images"):[],v=s.length?await i(s,"videos"):[],m=(l=>{const n=new Date(l),g=n.getFullYear(),d=String(n.getMonth()+1).padStart(2,"0"),u=String(n.getDate()).padStart(2,"0"),$=Math.random().toString(36).substring(2,6);return`${g}-${d}-${u}-${$}`})(e.date||new Date().toISOString()),M={...e,images:D,videos:v,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),isDeleted:!1},p=w(f,`users/${r}/memories`,m);return await O(p,M),a.value.unshift({id:m,...M}),m}}});export{X as u};
